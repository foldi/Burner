/*
Simple Sim
Copyright (c) 2013 Your name | your@email.com | http://yourwebsite.com
*/
/* Version: 0.0.1 */
/* Build time: May 19, 2013 07:28:48 */var SimpleSim={},exports=SimpleSim;
(function(f){function e(a,c){this.x=a||0;this.y=c||0}function j(){var a,c;this.name="StatsDisplay";this._active=!0;this._fps=0;this._timeLastSecond=this._timeLastFrame=this._time=Date.now?Date.now():0;this._frameCount=0;this.el=document.createElement("div");this.el.id="statsDisplay";this.el.className="statsDisplay";this.el.style.backgroundColor="black";this.el.style.color="white";this.el.style.fontFamily="Helvetica";this.el.style.padding="0.5em";this.el.style.opacity="0.5";this._fpsValue=this._totalElementsValue=
null;a=document.createElement("span");a.className="statsDisplayLabel";a.style.marginLeft="0.5em";c=document.createTextNode("total elements: ");a.appendChild(c);this.el.appendChild(a);this._totalElementsValue=document.createTextNode("0");this.el.appendChild(this._totalElementsValue);a=document.createElement("span");a.className="statsDisplayLabel";a.style.marginLeft="0.5em";c=document.createTextNode("fps: ");a.appendChild(c);this.el.appendChild(a);this._fpsValue=document.createTextNode("0");this.el.appendChild(this._fpsValue);
document.body.appendChild(this.el);this._update(this)}function i(a){if(!a||!a.world||"object"!==typeof a.world)throw Error('Item: A valid DOM object is required for the new Items\'s "world" property.');this.world=a.world;this.name=a.name||"Item";this.id=this.name+f.System.getNewId();this._force=new f.Vector;this._camera=new f.Vector;this.el=document.createElement("div");this.el.id=this.id;this.el.className="item "+this.name.toLowerCase();this.el.style.visibility="hidden";this.world.el.appendChild(this.el)}
function k(a,c){if(!a||"object"!==typeof a)throw Error('World: A valid DOM object is required for the new World\'s "el" property.');var d=c||{};this.el=a;this.name="World";this.height=this.width=0;this.color=d.color||[255,255,255];this.colorMode=d.color||"rgb";this.visibility=d.visibility||"visible";this.opacity=d.opacity||1;this.borderWidth=d.borderWidth||0;this.borderStyle=d.borderStyle||"none";this.borderColor=d.borderColor||"transparent";this.pauseDraw=this.pauseStep=!1;this.gravity=new f.Vector(0,
1);this.location=new f.Vector;this._setBounds();this.el.className="world";this._pool=[];this.world={}}function l(a){a=a||{};a.name="Box";f.Item.call(this,a)}function m(a){a=a||{};a.name="Ball";f.Item.call(this,a)}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};e.VectorSub=function(a,c){return new e(a.x-c.x,a.y-c.y)};e.VectorAdd=
function(a,c){return new e(a.x+c.x,a.y+c.y)};e.VectorMult=function(a,c){return new e(a.x*c,a.y*c)};e.VectorDiv=function(a,c){return new e(a.x/c,a.y/c)};e.VectorDistance=function(a,c){return Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2))};e.VectorMidPoint=function(a,c){return e.VectorAdd(a,c).div(2)};e.VectorAngleBetween=function(a,c){var d=a.dot(c);return Math.acos(d/(a.mag()*c.mag()))};e.prototype.name="Vector";e.prototype.clone=function(){function a(){}a.prototype=this;return new a};e.prototype.add=
function(a){this.x+=a.x;this.y+=a.y;return this};e.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};e.prototype.mult=function(a){this.x*=a;this.y*=a;return this};e.prototype.div=function(a){this.x/=a;this.y/=a;return this};e.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};e.prototype.limit=function(a){this.mag()>a&&(this.normalize(),this.mult(a));return this};e.prototype.normalize=function(){var a=this.mag();if(0!==a)return this.div(a)};e.prototype.distance=function(a){return Math.sqrt(Math.pow(a.x-
this.x,2)+Math.pow(a.y-this.y,2))};e.prototype.rotate=function(a){var c=Math.cos(a),a=Math.sin(a),d=this.x,b=this.y;this.x=d*c-b*a;this.y=d*a+b*c;return this};e.prototype.midpoint=function(a){return e.VectorAdd(this,a).div(2)};e.prototype.dot=function(a){return this.z&&a.z?this.x*a.x+this.y*a.y+this.z*a.z:this.x*a.x+this.y*a.y};f.Vector=e;j.prototype.getFPS=function(){return this._fps};j.prototype._update=function(a){var c=f.System.count();a._time=Date.now?Date.now():0;a._frameCount++;a._time>a._timeLastSecond+
1E3&&(a._fps=a._frameCount,a._timeLastSecond=a._time,a._frameCount=0,a._fpsValue.nodeValue=a._fps,a._totalElementsValue.nodeValue=c);var d=this;this._active&&window.requestAnimFrame(function(){d._update(d)})};j.prototype.destroy=function(){this._active=!1;document.getElementById(this.el.id)&&document.body.removeChild(this.el)};f.StatsDisplay=j;i.prototype.reset=function(a){this.width=a.width||10;this.height=a.height||10;this.color=a.color||[0,0,0];this.colorMode=a.colorMode||"rgb";this.visibility=
a.visibility||"visible";this.opacity=a.opacity||1;this.borderWidth=a.borderWidth||0;this.borderStyle=a.borderStyle||"none";this.borderColor=a.borderColor||"transparent";this.borderRadius=a.borderRadius||0;this.bounciness=a.bounciness||0.8;this.mass=a.mass||10;this.acceleration=new f.Vector;this.velocity=new f.Vector;this.location=a.location||new f.Vector(this.world.width/2,this.world.height/2);this.lifespan=a.lifespan||-1;this.life=a.life||0;this.isStatic=!!a.isStatic;this.controlCamera=!!a.controlCamera};
i.prototype.step=function(){this.isStatic||(this._applyForce(this.world.gravity),this.velocity.add(this.acceleration),this.location.add(this.velocity),this.controlCamera&&this._checkCameraEdges(),this._checkWorldEdges(),this.acceleration.mult(0),this.life<this.lifespan?this.life++:-1!==this.lifespan&&f.System.destroyItem(this))};i.prototype._applyForce=function(a){if(a)return this._force.x=a.x,this._force.y=a.y,this._force.div(this.mass),this.acceleration.add(this._force),this.acceleration};i.prototype._checkWorldEdges=
function(){var a=this.world.bounds[1],c=this.world.bounds[2],d=this.location,b=this.velocity,f=this.width,g=this.height,e=this.bounciness;d.x+f/2>a?(d.x=a-f/2,b.x*=-1*e):d.x<f/2&&(d.x=f/2,b.x*=-1*e);d.y+g/2>c?(d.y=c-g/2,b.y*=-1*e):d.y<g/2&&(d.y=g/2,b.y*=-1*e)};i.prototype._checkCameraEdges=function(){this._camera.x=this.velocity.x;this._camera.y=this.velocity.y;this.world.location.add(this._camera.mult(-1))};i.prototype.draw=function(){var a=f.System.getCSSText({x:this.location.x-this.width/2,y:this.location.y-
this.height/2,width:this.width,height:this.height,color:this.color,colorMode:this.colorMode,visibility:this.visibility,opacity:this.opacity,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderColor:this.borderColor,borderRadius:this.borderRadius});this.el.style.cssText=a};f.Item=i;var b={name:"System",clock:0,supportedFeatures:{csstransforms:!0,csstransforms3d:!0},_records:{lookup:{},list:[]},_idCount:0};b.mouse={location:new f.Vector,lastLocation:new f.Vector,velocity:new f.Vector};b._resizeTime=
0;b.init=function(a,c,d,e,n){a=a||function(){};d=d||document.body;e=e||{};c=c||{};n=n||!0;this.supportedFeatures="object"===typeof c&&"undefined"!==typeof c.csstransforms&&"undefined"!==typeof c.csstransforms3d?c:{csstransforms:!0,csstransforms3d:!0};document.body.onorientationchange=b.updateOrientation;b._records.list.push(new f.World(d,e));this._addEvent(document,"mousemove",function(a){b._recordMouseLoc.call(b,a)});this._addEvent(window,"touchstart",function(a){b._recordMouseLoc.call(b,a)});this._addEvent(window,
"touchmove",function(a){b._recordMouseLoc.call(b,a)});this._addEvent(window,"touchend",function(a){b._recordMouseLoc.call(b,a)});this._addEvent(window,"resize",function(a){b._resize.call(b,a)});this._addEvent(window,"devicemotion",function(a){var c=b._records.list[0],d=a.accelerationIncludingGravity.x,a=a.accelerationIncludingGravity.y;0===window.orientation?(c.gravity.x=d,c.gravity.y=-1*a):-90===window.orientation?(c.gravity.x=a,c.gravity.y=d):(c.gravity.x=-1*a,c.gravity.y=-1*d)});this._addEvent(window,
"keyup",function(a){b._keyup.call(b,a)});this._setup=a;this._setup.call(this);n&&this._update()};b.add=function(a,c){var d,b,e=this._records.list,g=this._records.lookup,h=c||{};h.world=e[0];if(this.getAllElementsByName(a,h.world._pool).length){d=0;for(b=h.world._pool.length;d<b;d++)if(h.world._pool[d].name===a){e[e.length]=h.world._pool.splice(d,1)[0];e[e.length-1].options=h;break}}else e[e.length]=SimpleSim[a]?new SimpleSim[a](h):new f.Box(h);d=e.length-1;g[e[d].id]=e[d].el.parentNode;e[d].reset(h);
e[d].init(h)};b.count=function(){return this._records.list.length};b._update=function(){var a,c=b._records.list,d;b._resizeTime&&100<(new Date).getTime()-b._resizeTime&&(b._resizeTime=0,c[0].pauseStep=!1);for(a=c.length-1;0<=a;a-=1)d=c[a],d.step&&!d.world.pauseStep&&d.step();for(a=c.length-1;0<=a;a-=1)d=c[a],d.draw&&!d.world.drawStep&&d.draw();b.clock++;window.requestAnimFrame(b._update)};b._stepForward=function(){var a,c=b._records.list;this._records.list[0].pauseStep=!0;for(a=c.length-1;0<=a;a-=
1)c[a].step();for(a=c.length-1;0<=a;a-=1)c[a].draw();b.clock++};b._resetSystem=function(){var a=this._records.list[0];a.pauseStep=!1;for(a.pauseDraw=!1;a.el.firstChild;)a.el.removeChild(a.el.firstChild);b._destroyAllItems();b._idCount=0;b.mouse={location:new f.Vector,lastLocation:new f.Vector,velocity:new f.Vector};b._resizeTime=0;b._setup.call(b)};b._destroyAllItems=function(){var a,c=this._records.list;for(a=c.length-1;0<=a;a--)"World"!==c[a].name&&c.splice(a,1)};b.destroyItem=function(a){var c,
d,b=this._records.list;c=0;for(d=b.length;c<d;c++)if(b[c].id===a.id){b[c].el.style.visibility="hidden";b[c].el.style.top="-5000px";b[c].el.style.left="-5000px";b[c].world._pool[b[c].world._pool.length]=b.splice(c,1)[0];break}};b.getAllElementsByName=function(a,c){var b,e,f=[],g=c||this._records.list;b=0;for(e=g.length;b<e;b++)g[b].name===a&&(f[f.length]=g[b]);return f};b._resize=function(){var a,c,b=this._records.list,e,f=this.getWindowSize(),g=b[0];this._resizeTime=(new Date).getTime();g.pauseStep=
!0;a=0;for(c=b.length;a<c;a++)e=b[a],"World"!==e.name&&(e.location.x=f.width*(e.location.x/g.width),e.location.y=f.height*(e.location.y/g.height));g._setBounds()};b._keyup=function(a){var c=this._records.list[0];switch(a.keyCode){case 39:b._stepForward();break;case 80:c.pauseStep=!c.pauseStep;break;case 82:b._resetSystem();break;case 83:b._toggleStats()}};b.getNewId=function(){this._idCount++;return this._idCount};b._addEvent=function(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&
a.attachEvent("on"+c,b)};b._recordMouseLoc=function(a){var c;this.mouse.lastLocation.x=this.mouse.location.x;this.mouse.lastLocation.y=this.mouse.location.y;a.changedTouches&&(c=a.changedTouches[0]);a.pageX&&a.pageY?(this.mouse.location.x=a.pageX,this.mouse.location.y=a.pageY):a.clientX&&a.clientY?(this.mouse.location.x=a.clientX,this.mouse.location.y=a.clientY):c&&(this.mouse.location.x=c.pageX,this.mouse.location.y=c.pageY);this.mouse.velocity.x=this.mouse.lastLocation.x-this.mouse.location.x;this.mouse.velocity.y=
this.mouse.lastLocation.y-this.mouse.location.y};b.extend=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a};b.getWindowSize=function(){var a={width:!1,height:!1};"undefined"!==typeof window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight):"undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight):
"undefined"!==typeof document.body&&(a.width=document.body.clientWidth,a.height=document.body.clientHeight);return a};b.updateOrientation=function(){setTimeout(function(){b._records.list[0]._setBounds()},500)};b.getRandomNumber=function(a,b,d){return d?Math.random()*(b-(a-1))+a:Math.floor(Math.random()*(b-(a-1)))+a};b._toggleStats=function(){b._statsDisplay?b._statsDisplay&&b._statsDisplay._active?b._statsDisplay.destroy():b._statsDisplay&&!b._statsDisplay._active&&(b._statsDisplay=new f.StatsDisplay):
b._statsDisplay=new f.StatsDisplay};b.getCSSText=function(a){var b,d,e,f;this.supportedFeatures.csstransforms3d?d="translate3d("+a.x+"px, "+a.y+"px, 0);":this.supportedFeatures.csstransforms?d="translateX("+a.x+"px) translateY("+a.y+"px);":b="position: absolute; left: "+a.x+"px;top: "+a.y+"px;";b||(b="-webkit-transform: "+d+"-moz-transform: "+d+"-o-transform: "+d+"-ms-transform: "+d);d="width: "+a.width+"px; height: "+a.height+"px;";"object"===typeof a.color?"rgb"===a.colorMode?e="background-color: rgb("+
a.color[0]+", "+a.color[1]+", "+a.color[2]+");":"hsl"===a.colorMode&&(e="background-color: hsl("+a.color[0]+", "+a.color[1]+"%, "+a.color[2]+"%);"):e="background-color: "+a.color+";";"object"===typeof a.borderColor?"rgb"===a.colorMode?f="rgb("+a.borderColor[0]+", "+a.borderColor[1]+", "+a.borderColor[2]+")":"hsl"===a.colorMode&&(f="hsl("+a.borderColor[0]+", "+a.borderColor[1]+"%, "+a.borderColor[2]+"%)"):f=a.borderColor;return b+d+e+("border: "+a.borderWidth+"px "+a.borderStyle+" "+f+";")+("border-radius: "+
a.borderRadius+"%;")+("visibility: "+a.visibility+";")+("opacity: "+a.opacity+";")};f.System=b;k.prototype.step=function(){};k.prototype.draw=function(){var a=f.System.getCSSText({x:this.location.x,y:this.location.y,width:this.width,height:this.height,color:this.color,colorMode:this.colorMode,visibility:this.visibility,opacity:this.opacity,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderColor:this.borderColor});this.el.style.cssText=a};k.prototype._setBounds=function(){var a=f.System.getWindowSize();
this.bounds=[0,a.width,a.height,0];this.width=a.width;this.height=a.height};f.World=k;f.System.extend(l,f.Item);l.prototype.init=function(a){this.width=a.width||20;this.height=a.height||20;this.color=a.color||[100,100,100];this.borderRadius=a.borderRadius||0};f.Box=l;f.System.extend(m,f.Item);m.prototype.init=function(a){this.width=a.width||20;this.height=a.height||20;this.color=a.color||[0,0,0];this.colorMode=a.colorMode||"rgb";this.borderRadius=a.borderRadius||100;this.opacity=a.opacity||0.8};f.Ball=
m})(exports);
